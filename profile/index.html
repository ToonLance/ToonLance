<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile - ToonLance</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #8a5cff;
      --primary-dark: #6a3dff;
      --light: #ffffff;
      --light-gray: #c5c5d6;
      --dark: #0d0d12;
      --darker: #07070b;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }
    
    body {
      background-color: var(--dark);
      color: var(--light);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    
    .profile-card {
      background: rgba(26, 26, 38, 0.9);
      border-radius: 1rem;
      padding: 2rem;
      width: 100%;
      max-width: 500px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    
    .profile-pic {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--primary);
      margin: 0 auto 1rem;
      display: block;
    }
    
    .profile-name {
      font-size: 1.5rem;
      margin-bottom: 0.25rem;
    }
    
    .profile-username {
      color: var(--primary);
      margin-bottom: 1rem;
      font-size: 1rem;
    }
    
    .profile-email {
      color: var(--light-gray);
      margin-bottom: 1.5rem;
      font-size: 0.9rem;
    }
    
    .profile-bio {
      background: rgba(255, 255, 255, 0.05);
      padding: 1rem;
      border-radius: 0.5rem;
      margin: 1.5rem 0;
      text-align: left;
      position: relative;
    }
    
    .profile-bio-text {
      min-height: 20px;
    }
    
    .profile-bio-edit {
      display: none;
      width: 100%;
    }
    
    .bio-textarea {
      width: 100%;
      min-height: 100px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 0.5rem;
      padding: 1rem;
      color: var(--light);
      resize: vertical;
    }
    
    .profile-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .profile-btn {
      flex: 1;
      padding: 0.8rem;
      border-radius: 0.5rem;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }
    
    .btn-outline {
      background: transparent;
      color: var(--primary);
      border: 1px solid var(--primary);
    }
    
    .btn-outline:hover {
      background: rgba(138, 92, 255, 0.1);
    }
    
    .hidden {
      display: none;
    }
    
    .edit-icon {
      position: absolute;
      top: 10px;
      right: 10px;
      color: var(--light-gray);
      cursor: pointer;
    }
    
    .edit-icon:hover {
      color: var(--primary);
    }
  </style>
</head>
<body>
  <div class="profile-card" id="profile-card">
    <img id="profile-pic" class="profile-pic" alt="Profile Picture">
    <h1 class="profile-name" id="profile-name">Loading...</h1>
    <p class="profile-username" id="profile-username">
      <span id="username-text">No username set</span>
      <i class="fas fa-edit edit-icon" id="edit-username-btn"></i>
    </p>
    <input type="text" id="username-input" class="hidden" placeholder="Enter username">
    <p class="profile-email" id="profile-email">Loading...</p>
    
    <div class="profile-bio">
      <div class="profile-bio-text" id="profile-bio-text">No bio added yet</div>
      <textarea class="profile-bio-edit" id="bio-textarea" placeholder="Tell us about yourself..."></textarea>
      <i class="fas fa-edit edit-icon" id="edit-bio-btn"></i>
    </div>
    
    <div class="profile-actions" id="edit-actions" style="display: none;">
      <button class="profile-btn btn-outline" id="cancel-edit-btn">Cancel</button>
      <button class="profile-btn btn-primary" id="save-edit-btn">Save</button>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
  
  <script>
    // Firebase configuration - replace with your actual config
    const firebaseConfig = {
      apiKey: "AIzaSyA1YGFbDHDuSQVXFsRO-XD7Usir9dULoEU",
    authDomain: "testing-dba79.firebaseapp.com",
    projectId: "testing-dba79",
    storageBucket: "testing-dba79.firebasestorage.app",
    messagingSenderId: "808371260131",
    appId: "1:808371260131:web:a59f409f532e617cba13d6"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();

    // DOM elements
    const profileName = document.getElementById('profile-name');
    const profileEmail = document.getElementById('profile-email');
    const profilePic = document.getElementById('profile-pic');
    const profileBioText = document.getElementById('profile-bio-text');
    const bioTextarea = document.getElementById('bio-textarea');
    const editBioBtn = document.getElementById('edit-bio-btn');
    const usernameText = document.getElementById('username-text');
    const usernameInput = document.getElementById('username-input');
    const editUsernameBtn = document.getElementById('edit-username-btn');
    const editActions = document.getElementById('edit-actions');
    const cancelEditBtn = document.getElementById('cancel-edit-btn');
    const saveEditBtn = document.getElementById('save-edit-btn');

    // Check auth state
    auth.onAuthStateChanged(user => {
      if (user) {
        // User is signed in
        loadProfile(user);
      } else {
        // No user signed in
        profileName.textContent = "Please sign in";
        profileEmail.textContent = "";
      }
    });

    // Load profile data
    function loadProfile(user) {
      // Set basic info from auth
      profileName.textContent = user.displayName || 'User';
      profileEmail.textContent = user.email || '';
      profilePic.src = user.photoURL || 'https://via.placeholder.com/150';
      
      // Load additional profile data from database
      database.ref('users/' + user.uid).once('value').then(snapshot => {
        const userData = snapshot.val();
        
        if (!userData) {
          // Create new profile if doesn't exist
          return database.ref('users/' + user.uid).set({
            name: user.displayName || 'User',
            email: user.email || '',
            photoURL: user.photoURL || 'https://via.placeholder.com/150'
          });
        }
        
        // Display existing profile data
        if (userData.username) {
          usernameText.textContent = '@' + userData.username;
        }
        
        if (userData.bio) {
          profileBioText.textContent = userData.bio;
        }
        
      }).catch(error => {
        console.error("Error loading profile:", error);
      });
      
      // Set up realtime listeners
      database.ref('users/' + user.uid + '/username').on('value', snapshot => {
        const username = snapshot.val();
        usernameText.textContent = username ? '@' + username : 'No username set';
      });
      
      database.ref('users/' + user.uid + '/bio').on('value', snapshot => {
        const bio = snapshot.val();
        profileBioText.textContent = bio || 'No bio added yet';
      });
    }

    // Edit buttons event listeners
    editBioBtn.addEventListener('click', () => startEditing('bio'));
    editUsernameBtn.addEventListener('click', () => startEditing('username'));

    // Start editing a field
    function startEditing(field) {
      if (isEditing) return;
      
      currentEditField = field;
      
      if (field === 'bio') {
        originalValue = profileBioText.textContent;
        profileBioText.style.display = 'none';
        bioTextarea.style.display = 'block';
        bioTextarea.value = originalValue === 'No bio added yet' ? '' : originalValue;
        editBioBtn.style.display = 'none';
      } else if (field === 'username') {
        originalValue = usernameText.textContent.replace('@', '') || '';
        usernameText.style.display = 'none';
        usernameInput.style.display = 'block';
        usernameInput.value = originalValue === 'No username set' ? '' : originalValue;
        editUsernameBtn.style.display = 'none';
      }
      
      editActions.style.display = 'flex';
    }

    // Cancel editing
    cancelEditBtn.addEventListener('click', cancelEditing);

    function cancelEditing() {
      if (currentEditField === 'bio') {
        profileBioText.style.display = 'block';
        bioTextarea.style.display = 'none';
        editBioBtn.style.display = 'block';
      } else if (currentEditField === 'username') {
        usernameText.style.display = 'block';
        usernameInput.style.display = 'none';
        editUsernameBtn.style.display = 'block';
      }
      
      currentEditField = null;
      editActions.style.display = 'none';
    }

    // Save edits
    saveEditBtn.addEventListener('click', saveEdits);

    function saveEdits() {
      if (!auth.currentUser) return;
      
      const userId = auth.currentUser.uid;
      let newValue;
      let dbPath;
      
      if (currentEditField === 'bio') {
        newValue = bioTextarea.value.trim();
        dbPath = 'bio';
      } else if (currentEditField === 'username') {
        newValue = usernameInput.value.trim();
        
        // Basic username validation
        if (!newValue) {
          alert("Username cannot be empty");
          return;
        }
        
        dbPath = 'username';
      }
      
      // Save to database
      database.ref('users/' + userId + '/' + dbPath).set(newValue || null)
        .then(() => {
          if (currentEditField === 'bio') {
            profileBioText.style.display = 'block';
            bioTextarea.style.display = 'none';
            editBioBtn.style.display = 'block';
          } else if (currentEditField === 'username') {
            usernameText.style.display = 'block';
            usernameInput.style.display = 'none';
            editUsernameBtn.style.display = 'block';
          }
          
          currentEditField = null;
          editActions.style.display = 'none';
        })
        .catch(error => {
          console.error("Error saving data:", error);
          alert("Failed to save. Please try again.");
        });
    }
  </script>
</body>
</html>