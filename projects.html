<!-- projects.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projects | ToonLance</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <div class="logo">
                    <a href="/">ToonLance</a>
                </div>
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <div class="nav-links" id="navLinks">
                    <a href="index.html">Home</a>
                    <a href="freelancers.html">Freelancers</a>
                    <a href="projects.html" class="active">Projects</a>
                    <a id="loginLink" class="nav-link">Login</a>
                    <a id="signupLink" class="nav-link">Sign Up</a>
                    <a href="profile.html" id="profileLink" style="display: none;">Profile</a>
                    <a id="logoutLink" class="nav-link" style="display: none;">Logout</a>
                </div>
            </nav>
        </div>
    </header>

    <section class="projects" id="projects">
        <div class="container">
            <h2 class="section-title">Post a Project</h2>
            <div class="project-form" id="projectForm" style="display: none;">
                <input type="text" id="projectTitle" placeholder="Project Title" required>
                <textarea id="projectDescription" placeholder="Project Description" required></textarea>
                <button class="btn btn-primary" onclick="postProject()">Post Project</button>
            </div>
            <h2 class="section-title">Available Projects</h2>
            <div class="project-list" id="projectList"></div>
        </div>
    </section>

    <!-- Role Selection Modal -->
    <div class="modal" id="roleModal">
        <div class="modal-content">
            <h3>Choose Your Role</h3>
            <p>Are you a client looking to hire animators or a freelancer looking for projects?</p>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="selectRole('client')">Client</button>
                <button class="btn btn-outline" onclick="selectRole('freelancer')">Freelancer</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="copyright">
            <p>Â© 2025 ToonLance. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
    <script src="firebase.js"></script>
    <script src="nav.js"></script>
    <script>
        // Post Project
        async function postProject() {
            if (!currentUser) {
                alert('Please sign in to post a project.');
                return;
            }
            const title = document.getElementById('projectTitle').value;
            const description = document.getElementById('projectDescription').value;
            if (title && description) {
                await db.collection('projects').add({
                    title,
                    description,
                    clientId: currentUser.uid,
                    clientName: currentUser.displayName,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'open'
                });
                document.getElementById('projectTitle').value = '';
                document.getElementById('projectDescription').value = '';
                loadProjects();
            } else {
                alert('Please fill in all fields.');
            }
        }

        // Load Projects
        async function loadProjects() {
            const projectList = document.getElementById('projectList');
            projectList.innerHTML = '';
            const snapshot = await db.collection('projects').orderBy('createdAt', 'desc').get();
            snapshot.forEach(doc => {
                const project = doc.data();
                const projectDiv = document.createElement('div');
                projectDiv.className = 'project-card';
                projectDiv.innerHTML = `
                    <h3>${project.title}</h3>
                    <p>${project.description}</p>
                    <p>Posted by: ${project.clientName}</p>
                    <p>Status: ${project.status}</p>
                `;
                if (currentUser && currentUser.uid !== project.clientId && project.status === 'open') {
                    projectDiv.innerHTML += `
                        <button class="btn btn-primary" onclick="applyForProject('${doc.id}')">Apply</button>
                    `;
                }
                projectList.appendChild(projectDiv);
            });
        }

        // Apply for Project
        async function applyForProject(projectId) {
            if (!currentUser) {
                alert('Please sign in to apply for a project.');
                return;
            }
            await db.collection('applications').add({
                projectId,
                freelancerId: currentUser.uid,
                freelancerName: currentUser.displayName,
                appliedAt: firebase.firestore.FieldValue.serverTimestamp(),
                status: 'pending'
            });
            alert('Application submitted!');
        }

        // Initialize
        auth.onAuthStateChanged(user => {
            currentUser = user;
            if (user) {
                db.collection('users').doc(user.uid).get().then(doc => {
                    if (doc.exists && doc.data().role === 'client') {
                        document.getElementById('projectForm').style.display = 'block';
                    }
                });
            }
            loadProjects();
        });
    </script>
</body>
</html>
