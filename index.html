<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FreelanceHub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
    <style>
        :root {
            --bg: #000;
            --card-bg: #111;
            --text: #fff;
            --primary: #4CAF50;
            --secondary: #2196F3;
        }
        body {
            background: var(--bg);
            color: var(--text);
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #333;
        }
        section {
            display: none;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 8px;
        }
        .active { display: block; }
        button {
            background: #333;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover { background: #444; }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            background: #222;
            border: 1px solid #333;
            color: white;
            border-radius: 4px;
        }
        .message {
            background: #222;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .my-message { background: #2d2d2d; margin-left: 20%; }
        .their-message { background: #333; margin-right: 20%; }
        #message-container {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #333;
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .project-card {
            background: #222;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <header>
        <h1>FreelanceHub</h1>
        <div id="auth-buttons">
            <button onclick="showSection('login')">Login</button>
            <button onclick="showSection('register')">Register</button>
        </div>
        <div id="user-menu" style="display:none;">
            <span id="user-email"></span>
            <button onclick="showSection('dashboard')">Dashboard</button>
            <button onclick="logout()">Logout</button>
        </div>
    </header>

    <!-- Auth Sections -->
    <section id="login" class="active">
        <h2>Login</h2>
        <input type="email" id="loginEmail" placeholder="Email">
        <input type="password" id="loginPassword" placeholder="Password">
        <button onclick="login()">Login</button>
        <p id="loginError" style="color:red;"></p>
    </section>

    <section id="register">
        <h2>Register</h2>
        <input type="email" id="regEmail" placeholder="Email">
        <input type="password" id="regPassword" placeholder="Password">
        <select id="regRole">
            <option value="client">Client</option>
            <option value="freelancer">Freelancer</option>
        </select>
        <button onclick="register()">Register</button>
        <p id="regError" style="color:red;"></p>
    </section>

    <!-- Main App Sections -->
    <section id="dashboard">
        <h2>Dashboard</h2>
        <div id="dashboard-content"></div>
    </section>

    <section id="profile">
        <h2>My Profile</h2>
        <input type="text" id="profileName" placeholder="Name">
        <textarea id="profileBio" placeholder="Bio"></textarea>
        <button onclick="saveProfile()">Save Profile</button>
    </section>

    <section id="projects">
        <h2>Projects</h2>
        <button onclick="showSection('new-project')">New Project</button>
        <div id="projects-list"></div>
    </section>

    <section id="new-project">
        <h2>New Project</h2>
        <input type="text" id="projectTitle" placeholder="Title">
        <textarea id="projectDesc" placeholder="Description"></textarea>
        <input type="number" id="projectBudget" placeholder="Budget">
        <button onclick="postProject()">Post Project</button>
    </section>

    <section id="messages">
        <h2>Messages</h2>
        <div id="message-container"></div>
        <input type="text" id="message-input" placeholder="Type message...">
        <input type="file" id="file-upload" hidden>
        <button onclick="document.getElementById('file-upload').click()">ðŸ“Ž</button>
        <button onclick="sendMessage()">Send</button>
    </section>

<script>
// Firebase Config
const firebaseConfig = {
    apiKey: "AIzaSyA1YGFbDHDuSQVXFsRO-XD7Usir9dULoEU",
    authDomain: "testing-dba79.firebaseapp.com",
    projectId: "testing-dba79",
    storageBucket: "testing-dba79.firebasestorage.app",
    messagingSenderId: "808371260131",
    appId: "1:808371260131:web:a59f409f532e617cba13d6"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

let currentUser = null;
let currentProjectId = null;

// Auth State Listener
auth.onAuthStateChanged(user => {
    currentUser = user;
    if (user) {
        document.getElementById('auth-buttons').style.display = 'none';
        document.getElementById('user-menu').style.display = 'block';
        document.getElementById('user-email').textContent = user.email;
        showSection('dashboard');
        loadDashboard();
    } else {
        document.getElementById('auth-buttons').style.display = 'block';
        document.getElementById('user-menu').style.display = 'none';
        showSection('login');
    }
});

// Auth Functions
function login() {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    auth.signInWithEmailAndPassword(email, password)
        .catch(error => document.getElementById('loginError').textContent = error.message);
}

function register() {
    const email = document.getElementById('regEmail').value;
    const password = document.getElementById('regPassword').value;
    const role = document.getElementById('regRole').value;
    auth.createUserWithEmailAndPassword(email, password)
        .then(cred => db.collection('users').doc(cred.user.uid).set({ email, role }))
        .catch(error => document.getElementById('regError').textContent = error.message);
}

function logout() {
    auth.signOut();
}

// UI Functions
function showSection(sectionId) {
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
    document.getElementById(sectionId).classList.add('active');
}

// Dashboard
function loadDashboard() {
    const role = currentUser.role;
    const content = document.getElementById('dashboard-content');
    
    if (role === 'client') {
        content.innerHTML = `
            <button onclick="showSection('new-project')">Post New Project</button>
            <button onclick="loadMyProjects()">My Projects</button>
        `;
    } else {
        content.innerHTML = `
            <button onclick="loadProjects()">Browse Projects</button>
            <button onclick="loadMyBids()">My Bids</button>
        `;
    }
}

// Project Functions
function postProject() {
    const project = {
        title: document.getElementById('projectTitle').value,
        description: document.getElementById('projectDesc').value,
        budget: document.getElementById('projectBudget').value,
        client: currentUser.uid,
        createdAt: new Date()
    };
    db.collection('projects').add(project)
        .then(() => showSection('projects'));
}

function loadProjects() {
    db.collection('projects').get().then(snapshot => {
        const list = document.getElementById('projects-list');
        list.innerHTML = '';
        snapshot.forEach(doc => {
            const project = doc.data();
            list.innerHTML += `
                <div class="project-card">
                    <h3>${project.title}</h3>
                    <p>${project.description}</p>
                    <p>Budget: $${project.budget}</p>
                    <button onclick="bidProject('${doc.id}')">Bid</button>
                    <button onclick="openMessages('${doc.id}')">Message</button>
                </div>
            `;
        });
        showSection('projects');
    });
}

// Messaging
let messagesUnsubscribe = null;

function openMessages(projectId) {
    currentProjectId = projectId;
    if (messagesUnsubscribe) messagesUnsubscribe();
    
    messagesUnsubscribe = db.collection('projects').doc(projectId)
        .collection('messages')
        .orderBy('createdAt')
        .onSnapshot(snapshot => {
            const container = document.getElementById('message-container');
            container.innerHTML = '';
            snapshot.forEach(doc => {
                const msg = doc.data();
                const isMe = msg.sender === currentUser.uid;
                container.innerHTML += `
                    <div class="message ${isMe ? 'my-message' : 'their-message'}">
                        ${msg.text || ''}
                        ${msg.file ? `<img src="${msg.file}" width="100">` : ''}
                        <small>${new Date(msg.createdAt?.toDate()).toLocaleTimeString()}</small>
                    </div>
                `;
            });
            container.scrollTop = container.scrollHeight;
        });
    
    showSection('messages');
}

async function sendMessage() {
    const input = document.getElementById('message-input');
    const file = document.getElementById('file-upload').files[0];
    let fileUrl = '';

    if (file) {
        const storageRef = storage.ref(`messages/${currentProjectId}/${file.name}`);
        await storageRef.put(file);
        fileUrl = await storageRef.getDownloadURL();
    }

    db.collection('projects').doc(currentProjectId).collection('messages').add({
        text: input.value,
        file: fileUrl,
        sender: currentUser.uid,
        createdAt: new Date()
    });

    input.value = '';
    document.getElementById('file-upload').value = '';
}

// Initialize
showSection('login');
</script>
</body>
</html>
